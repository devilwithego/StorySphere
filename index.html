<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Your Story - Mental Health Support Community</title>
    <meta name="description" content="A safe space to share your mental health story anonymously or with your name. Connect with others and find support in our community.">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom styles -->
    <style>
        :root {
            --primary: 239 68% 55%;
            --secondary: 210 8% 50%;
            --warm-gray: 220 14% 96%;
        }
        
        .bg-primary { background-color: hsl(var(--primary)); }
        .text-primary { color: hsl(var(--primary)); }
        .border-primary { border-color: hsl(var(--primary)); }
        .hover\:bg-primary:hover { background-color: hsl(var(--primary)); }
        
        .bg-secondary { background-color: hsl(var(--secondary)); }
        .text-secondary { color: hsl(var(--secondary)); }
        
        .bg-warm-gray { background-color: hsl(var(--warm-gray)); }
        
        .prose { line-height: 1.7; }
        .prose p { margin-bottom: 1em; }
        
        /* Form styles */
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: hsl(var(--primary));
            box-shadow: 0 0 0 3px hsla(var(--primary), 0.1);
        }
        
        .btn-primary {
            background-color: hsl(var(--primary));
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background-color: hsl(239 68% 50%);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-outline {
            background-color: transparent;
            color: hsl(var(--primary));
            border: 1px solid hsl(var(--primary));
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-outline:hover {
            background-color: hsl(var(--primary));
            color: white;
        }
        
        .radio-group input[type="radio"] {
            margin-right: 0.5rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-right: 0.5rem;
        }
        
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            min-width: 300px;
        }
        
        .toast.success {
            border-left: 4px solid #10b981;
        }
        
        .toast.error {
            border-left: 4px solid #ef4444;
        }
    </style>
</head>
<body class="font-sans antialiased bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-100">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center">
                        <svg class="text-white h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900">Share Your Story</h1>
                </div>
                
                <nav class="hidden md:flex items-center space-x-6">
                    <button onclick="scrollToSection('share')" class="text-secondary hover:text-primary transition-colors">
                        Share
                    </button>
                    <button onclick="scrollToSection('stories')" class="text-secondary hover:text-primary transition-colors">
                        Stories
                    </button>
                    <button onclick="scrollToSection('how-it-works')" class="text-secondary hover:text-primary transition-colors">
                        How It Works
                    </button>
                    <button onclick="scrollToSection('support')" class="text-secondary hover:text-primary transition-colors">
                        Support
                    </button>
                    <a href="mailto:devilwithego@gmail.com" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-indigo-600 transition-colors">
                        Contact
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="bg-gradient-to-b from-indigo-50 to-white py-16">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">
                Your Voice Matters
            </h2>
            <p class="text-xl text-secondary mb-8 max-w-2xl mx-auto leading-relaxed">
                Share your story, connect with others, and find support in our safe community. 
                Whether you choose to remain anonymous or share your name, your experience matters.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="scrollToSection('share')" class="btn-primary">
                    Share Your Story
                </button>
                <button onclick="scrollToSection('how-it-works')" class="btn-outline">
                    How It Works
                </button>
            </div>
        </div>
    </section>

    <!-- Story Submission Form -->
    <section id="share" class="py-16 bg-white">
        <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-gray-900 mb-4">Share Your Story</h3>
                <p class="text-secondary text-lg">Your story can help others feel less alone. Choose to share anonymously or with your name.</p>
            </div>
            
            <div class="bg-warm-gray border border-gray-100 rounded-lg shadow-sm p-8">
                <form id="storyForm" action="https://formspree.io/f/mpwrkdea" method="POST" onsubmit="submitStory(event)">
                    <!-- Privacy Options -->
                    <div class="bg-white border border-gray-100 rounded-lg p-6 mb-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">Privacy Options</h4>
                        <div class="radio-group space-y-3">
                            <div class="flex items-center">
                                <input type="radio" id="anonymous" name="privacy" value="anonymous" checked>
                                <label for="anonymous" class="cursor-pointer">
                                    Post anonymously (your name won't be shown)
                                </label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" id="named" name="privacy" value="named">
                                <label for="named" class="cursor-pointer">
                                    Show my name with the story
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Information -->
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                            <input type="text" id="name" name="name" required class="form-input" placeholder="Your full name">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email Address *</label>
                            <input type="email" id="email" name="email" required class="form-input" placeholder="your.email@example.com">
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="age" class="block text-sm font-medium text-gray-700 mb-2">Age *</label>
                            <input type="number" id="age" name="age" required min="13" max="120" class="form-input" placeholder="Your age">
                        </div>
                        <div>
                            <label for="occupation" class="block text-sm font-medium text-gray-700 mb-2">Occupation/Education *</label>
                            <select id="occupation" name="occupation" required class="form-input">
                                <option value="">Select your status</option>
                                <option value="student-school">School Student</option>
                                <option value="student-university">University Student</option>
                                <option value="employed">Employed</option>
                                <option value="unemployed">Unemployed</option>
                                <option value="self-employed">Self-Employed</option>
                                <option value="retired">Retired</option>
                                <option value="prefer-not-to-say">Prefer not to say</option>
                            </select>
                        </div>
                    </div>

                    <!-- Story Content -->
                    <div class="mb-6">
                        <label for="story" class="block text-sm font-medium text-gray-700 mb-2">Your Story *</label>
                        <textarea id="story" name="story" required rows="10" minlength="50" class="form-input resize-none" placeholder="Share your experience, feelings, or thoughts. Take your time - there's no rush. Your words matter."></textarea>
                        <p class="text-sm text-secondary mt-2">
                            Minimum 50 characters. Take your time to express yourself fully.
                        </p>
                    </div>

                    <!-- Category Tags -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Story Category (Optional)</label>
                        <div class="checkbox-group grid grid-cols-2 md:grid-cols-3 gap-3">
                            <div class="flex items-center">
                                <input type="checkbox" id="depression" name="categories" value="depression">
                                <label for="depression" class="cursor-pointer text-sm">Depression</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="anxiety" name="categories" value="anxiety">
                                <label for="anxiety" class="cursor-pointer text-sm">Anxiety</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="loss" name="categories" value="loss">
                                <label for="loss" class="cursor-pointer text-sm">Loss & Grief</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="hope" name="categories" value="hope">
                                <label for="hope" class="cursor-pointer text-sm">Hope & Recovery</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="relationships" name="categories" value="relationships">
                                <label for="relationships" class="cursor-pointer text-sm">Relationships</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="other" name="categories" value="other">
                                <label for="other" class="cursor-pointer text-sm">Other</label>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="text-center pt-4">
                        <button type="submit" id="submitBtn" class="btn-primary text-lg">
                            <svg class="inline w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                            Share Your Story
                        </button>
                        <p class="text-sm text-secondary mt-4">
                            Your story will be reviewed and published within 24 hours. We respect your privacy and will never share your email address.
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Shared Stories -->
    <section id="stories" class="py-16 bg-gray-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-gray-900 mb-4">Community Stories</h3>
                <p class="text-secondary text-lg">Real stories from our community. You are not alone.</p>
            </div>

            <div id="storiesContainer" class="space-y-6">
                <!-- Stories will be displayed here -->
                <div id="noStoriesMessage" class="text-center py-12">
                    <div class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="text-gray-400 h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">No stories yet</h4>
                    <p class="text-secondary">Be the first to share your story and help others feel less alone.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- How it Works -->
    <section id="how-it-works" class="py-16 bg-warm-gray">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-gray-900 mb-4">How It Works</h3>
                <p class="text-secondary text-lg">Simple steps to share your story and connect with others.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-8">
                <div class="text-center">
                    <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-white font-bold text-xl">1</span>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Share Your Story</h4>
                    <p class="text-secondary">Fill out the form above with your experience. Choose to remain anonymous or share your name.</p>
                </div>

                <div class="text-center">
                    <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-white font-bold text-xl">2</span>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">We Review</h4>
                    <p class="text-secondary">Your story is sent to our team at devilwithego@gmail.com for review to ensure a safe space for everyone.</p>
                </div>

                <div class="text-center">
                    <div class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-white font-bold text-xl">3</span>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Help Others</h4>
                    <p class="text-secondary">Approved stories may be featured to help others feel less alone in their journey.</p>
                </div>
            </div>

            <div class="mt-12 bg-white rounded-2xl p-8 border border-gray-100">
                <h4 class="text-xl font-semibold text-gray-900 mb-4 text-center">Your Privacy Matters</h4>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h5 class="font-medium text-gray-900 mb-2">Anonymous Option</h5>
                        <p class="text-secondary text-sm">Choose to share without your name. Only you and our team will know who submitted the story.</p>
                    </div>
                    <div>
                        <h5 class="font-medium text-gray-900 mb-2">Email Privacy</h5>
                        <p class="text-secondary text-sm">Your email is never shared publicly and is only used for communication about your submission.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Support Resources -->
    <section id="support" class="py-16 bg-white">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-gray-900 mb-4">Need Support?</h3>
                <p class="text-secondary text-lg">You don't have to face this alone. Here are some resources that can help.</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-warm-gray border border-gray-100 rounded-lg p-6 text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="text-green-600 h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                        </svg>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Crisis Hotline</h4>
                    <p class="text-secondary text-sm mb-4">24/7 support for immediate help</p>
                    <a href="tel:988" class="text-primary hover:text-indigo-600 font-medium">
                        Call 988
                    </a>
                </div>

                <div class="bg-warm-gray border border-gray-100 rounded-lg p-6 text-center">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="text-blue-600 h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Text Support</h4>
                    <p class="text-secondary text-sm mb-4">Text-based crisis support</p>
                    <a href="sms:741741" class="text-primary hover:text-indigo-600 font-medium">
                        Text 741741
                    </a>
                </div>

                <div class="bg-warm-gray border border-gray-100 rounded-lg p-6 text-center">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="text-purple-600 h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-2">Find a Therapist</h4>
                    <p class="text-secondary text-sm mb-4">Professional mental health support</p>
                    <a href="https://www.psychologytoday.com" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-indigo-600 font-medium">
                        Find Help
                    </a>
                </div>
            </div>

            <div class="mt-12 bg-indigo-50 border border-indigo-100 rounded-lg p-8 text-center">
                <h4 class="text-xl font-semibold text-gray-900 mb-4">Remember</h4>
                <p class="text-secondary text-lg">
                    If you're having thoughts of suicide or self-harm, please reach out for help immediately. 
                    Your life has value, and there are people who want to help you through this difficult time.
                </p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 py-12">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-4 gap-8">
                <div class="md:col-span-2">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center">
                            <svg class="text-white h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h4 class="text-xl font-bold text-white">Share Your Story</h4>
                    </div>
                    <p class="text-gray-400 mb-4 max-w-md">
                        A safe space for sharing experiences, connecting with others, and finding support in our community.
                    </p>
                    <a href="mailto:devilwithego@gmail.com" class="text-primary hover:text-indigo-400 transition-colors">
                        devilwithego@gmail.com
                    </a>
                </div>

                <div>
                    <h5 class="text-white font-semibold mb-4">Community</h5>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#share" class="hover:text-white transition-colors">Share Your Story</a></li>
                        <li><a href="#how-it-works" class="hover:text-white transition-colors">How It Works</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Community Guidelines</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Privacy Policy</a></li>
                    </ul>
                </div>

                <div>
                    <h5 class="text-white font-semibold mb-4">Support</h5>
                    <ul class="space-y-2 text-sm">
                        <li><a href="tel:988" class="hover:text-white transition-colors">Crisis Hotline: 988</a></li>
                        <li><a href="sms:741741" class="hover:text-white transition-colors">Text Support: 741741</a></li>
                        <li><a href="mailto:devilwithego@gmail.com" class="hover:text-white transition-colors">Contact Us</a></li>
                        <li><a href="#support" class="hover:text-white transition-colors">Resources</a></li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-gray-800 mt-8 pt-8 text-center">
                <p class="text-gray-400 text-sm">
                    © 2024 Share Your Story. Made with ❤️ for mental health awareness.
                </p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadStories();
        });

        function scrollToSection(id) {
            const element = document.getElementById(id);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="font-semibold">${type === 'success' ? 'Success!' : 'Error!'}</div>
                <div class="text-sm text-gray-600">${message}</div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        function formatTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} minutes ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
            return `${Math.floor(diffInSeconds / 86400)} days ago`;
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
        }

        function createStoryCard(story) {
            const displayName = story.privacy === 'anonymous' ? 'Anonymous' : story.name;
            const initials = story.privacy === 'anonymous' ? 'A' : getInitials(story.name);
            
            return `
                <div class="bg-white border border-gray-100 rounded-lg p-6 shadow-sm">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-primary text-white rounded-full flex items-center justify-center font-semibold">
                                ${initials}
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">${displayName}</h4>
                                <p class="text-sm text-secondary">${story.age} years old • ${story.occupation.replace('-', ' ')}</p>
                            </div>
                        </div>
                        <span class="text-sm text-secondary">${formatTimeAgo(new Date(story.timestamp))}</span>
                    </div>
                    
                    <div class="prose prose-sm max-w-none mb-4">
                        <p class="text-gray-700 leading-relaxed">${story.story}</p>
                    </div>
                    
                    ${story.categories.length > 0 ? `
                        <div class="flex flex-wrap gap-2 mb-4">
                            ${story.categories.map(cat => `
                                <span class="px-2 py-1 bg-indigo-50 text-primary text-xs rounded-md capitalize">
                                    ${cat}
                                </span>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="flex items-center justify-between pt-4 border-t border-gray-100">
                        <button onclick="likeStory(${story.id})" class="flex items-center space-x-2 text-secondary hover:text-primary transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                            <span>${story.likes || 0} likes</span>
                        </button>
                        
                        <button onclick="toggleComments(${story.id})" class="flex items-center space-x-2 text-secondary hover:text-primary transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                            </svg>
                            <span>${story.comments ? story.comments.length : 0} comments</span>
                        </button>
                    </div>
                    
                    <div id="comments-${story.id}" class="hidden mt-4 pt-4 border-t border-gray-100">
                        ${story.comments ? story.comments.map(comment => `
                            <div class="mb-3 p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-2 mb-1">
                                    <span class="font-medium text-sm">${comment.name}</span>
                                    <span class="text-xs text-secondary">${formatTimeAgo(new Date(comment.timestamp))}</span>
                                </div>
                                <p class="text-sm text-gray-700">${comment.content}</p>
                            </div>
                        `).join('') : ''}
                        
                        <div class="mt-3">
                            <input type="text" placeholder="Add a supportive comment..." 
                                   class="w-full p-2 border border-gray-200 rounded-lg text-sm"
                                   onkeypress="handleCommentSubmit(event, ${story.id})">
                        </div>
                    </div>
                </div>
            `;
        }

        function loadStories() {
            const stories = JSON.parse(localStorage.getItem('sharedStories') || '[]');
            const container = document.getElementById('storiesContainer');
            const noStoriesMessage = document.getElementById('noStoriesMessage');
            
            if (stories.length === 0) {
                noStoriesMessage.style.display = 'block';
                return;
            }
            
            noStoriesMessage.style.display = 'none';
            container.innerHTML = stories.map(story => createStoryCard(story)).join('');
        }

        function saveStory(storyData) {
            const stories = JSON.parse(localStorage.getItem('sharedStories') || '[]');
            const newStory = {
                id: Date.now(),
                ...storyData,
                timestamp: new Date().toISOString(),
                likes: 0,
                comments: []
            };
            
            stories.unshift(newStory);
            localStorage.setItem('sharedStories', JSON.stringify(stories));
            loadStories();
        }

        function likeStory(storyId) {
            const stories = JSON.parse(localStorage.getItem('sharedStories') || '[]');
            const story = stories.find(s => s.id === storyId);
            if (story) {
                story.likes = (story.likes || 0) + 1;
                localStorage.setItem('sharedStories', JSON.stringify(stories));
                loadStories();
            }
        }

        function toggleComments(storyId) {
            const commentsDiv = document.getElementById(`comments-${storyId}`);
            commentsDiv.classList.toggle('hidden');
        }

        function handleCommentSubmit(event, storyId) {
            if (event.key === 'Enter' && event.target.value.trim()) {
                const stories = JSON.parse(localStorage.getItem('sharedStories') || '[]');
                const story = stories.find(s => s.id === storyId);
                
                if (story) {
                    if (!story.comments) story.comments = [];
                    story.comments.push({
                        name: 'Anonymous',
                        content: event.target.value.trim(),
                        timestamp: new Date().toISOString()
                    });
                    
                    localStorage.setItem('sharedStories', JSON.stringify(stories));
                    event.target.value = '';
                    loadStories();
                }
            }
        }

        async function submitStory(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = `
                <svg class="inline w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Sharing...
            `;
            
            try {
                const form = document.getElementById('storyForm');
                
                // Get all form data
                const name = form.name.value;
                const email = form.email.value;
                const age = form.age.value;
                const occupation = form.occupation.value;
                const story = form.story.value;
                const privacy = form.privacy.value;
                
                // Get selected categories
                const categories = [];
                const categoryCheckboxes = form.querySelectorAll('input[name="categories"]:checked');
                categoryCheckboxes.forEach(checkbox => {
                    categories.push(checkbox.value);
                });
                
                // Validate story length
                if (story.length < 50) {
                    throw new Error('Story must be at least 50 characters long');
                }
                
                // Create FormData for Formspree
                const formData = new FormData();
                formData.append('name', name);
                formData.append('email', email);
                formData.append('age', age);
                formData.append('occupation', occupation);
                formData.append('story', story);
                formData.append('privacy', privacy);
                formData.append('categories', categories.join(', '));
                
                // Add hidden field for Formspree email identification
                formData.append('_subject', 'New Story Submission from Share Your Story');
                formData.append('_replyto', email);
                
                // Submit to Formspree (this sends email to devilwithego@gmail.com)
                const response = await fetch('https://formspree.io/f/mpwrkdea', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    // Save story locally for display on website
                    const storyData = {
                        name,
                        email,
                        age: parseInt(age),
                        occupation,
                        story,
                        privacy,
                        categories
                    };
                    
                    saveStory(storyData);
                    
                    showToast('Thank you for sharing your experience. Your story has been sent to our team and is now visible on the website.', 'success');
                    form.reset();
                    
                    // Scroll to stories section to show the new story
                    setTimeout(() => {
                        scrollToSection('stories');
                    }, 1000);
                    
                } else {
                    throw new Error('Submission failed');
                }
                
            } catch (error) {
                showToast('Something went wrong. Please try again later or contact us directly.', 'error');
                console.error('Error:', error);
            } finally {
                // Restore button
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }
    </script>
</body>
</html>
